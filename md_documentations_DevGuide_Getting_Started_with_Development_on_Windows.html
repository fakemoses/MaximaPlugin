<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Maxima Plugin: Project Structure &amp; Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Maxima Plugin
   </div>
   <div id="projectbrief">A SMath Plugin</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_documentations_DevGuide_Getting_Started_with_Development_on_Windows.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Project Structure &amp; Examples </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md3"></a>
Folder in root directory</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Directory   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ControlObjects   </td><td class="markdownTableBodyNone">A collection of classes and components that manages translation and communication that is accessible by other classes. It also manage XML read-write    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Converter   </td><td class="markdownTableBodyNone">Houses classes and functions that are responsible for data conversion and formatting from SMath to Maxima and vice versa..    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MForms   </td><td class="markdownTableBodyNone">Contains user interface forms and windows that are intrinsically tied to the project's functionality. These elements shape the user's interaction with the Plugin, creating an intuitive and user-friendly experience.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MFunctions   </td><td class="markdownTableBodyNone">Serves as the repository for various functions and methods that make up the core of the Plugin.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MInstaller   </td><td class="markdownTableBodyNone">Contain the classes that handles URL extraction, file download and installation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PlotImage   </td><td class="markdownTableBodyNone">Contains classes and functions responsible for the plugin's image plotting and rendering capabilities.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Resources   </td><td class="markdownTableBodyNone">Contains assets such as logo and icon files for the plugin.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">lib   </td><td class="markdownTableBodyNone">Accommodates external libraries and dependencies required for the plugin.   </td></tr>
</table>
<p >In the root folder, there are also the following files:</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Files in root directory</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Files   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MainClass.cs   </td><td class="markdownTableBodyNone">Entry point for the plugin/codebase. Contain the implementation that defines the plugin functionalities    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SharedFunctions.cs   </td><td class="markdownTableBodyNone">Contain methods that are used by multiple classes throughout the codebase    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MCustomGlyphs.cs   </td><td class="markdownTableBodyNone">Manages the custom Glyphs for Maxima function and Cross product function   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md5"></a>
Main component of the project</h1>
<p >Here the core component of the project and their locations are elaborated. The term function refer to SMath functions and the term method refer to the method of a class.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
1. Entry point</h2>
<p >The MainClass.cs is the entry point of this plugin. This file define many functionalities of the plugin such as the functions that is evaluated by the plugin, the menu bar items and many more.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
2. Utilities and Mathematical Functions</h2>
<p >In this plugin, functions are categorized into three main types:</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Utility Functions</h3>
<p >These functions perform additional tasks for the plugin. Examples include:</p><ul>
<li><code>Maxima()</code></li>
<li><code>MaximaTakeover()</code></li>
<li><code>MaximaLog()</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md9"></a>
Symbolic alternatives Functions</h3>
<p >Symbolic alternatives functions are one of the many mathematical functions of the plugin. Examples are:</p><ul>
<li><code>Int()</code></li>
<li><code>Det()</code></li>
<li><code>Sum()</code></li>
<li>And many more.</li>
</ul>
<h3><a class="anchor" id="autotoc_md10"></a>
Wrapper Functions</h3>
<p >Wrapper functions include:</p><ul>
<li><code>Solve()</code></li>
<li><code>Fit()</code></li>
<li><code>Residual()</code></li>
<li>And many more.</li>
</ul>
<p >You can find the methods responsible for processing these functions in the <code>MFunctions</code> folder within the following files:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File Name   </th><th class="markdownTableHeadNone">Type of Functions    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MaximaAllround.cs   </td><td class="markdownTableBodyNone">Utility Functions    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DirectMaximaFunctions.cs   </td><td class="markdownTableBodyNone">Wrapper Functions    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">InternOverwrite.cs   </td><td class="markdownTableBodyNone">Symbolic Alternative Functions   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md11"></a>
3. Translation Interface</h2>
<p >The Translation Interface is responsible for the seamless translation of input and output between SMath and Maxima, ensuring smooth communication in both directions.</p>
<p >In many classes throughout this plugin, the <code>Translator</code> class plays a vital role in handling this translation and communication process. You can locate the <code>Translator</code> class in the <code>CommunicationInterface.cs</code> file. Methods responsible for managing symbolic alternative functions and wrapper functions often make use of the <code>Ask()</code> method within the <code>Translator</code> class.</p>
<p >Classes related to this interface are distributed across various files and folders, specifically within the <code>ControlObjects</code> and <code>Converter</code> directories. Here is an overview of the class diagram:</p>
<div class="image">
<img src="classdiagramtranslation.png" alt=""/>
<div class="caption">
Class Diagram of Translation Interface</div></div>
    <h2><a class="anchor" id="autotoc_md12"></a>
4. Communication Interface</h2>
<p >Communication Interface's primary responsibilities are to create a socket connection, connect Maxima, initialize Maxima, manage the session by facilitating the communication of SMath and Maxima, provide logging functionalities, and even manage the configuration files. Mainly, the communication interface for most classes begins in the <code>Ask()</code> method of the <code>Translator</code> class, where after the translation to Maxima is done, the input will be sent to Maxima, and output from Maxima is received and sent for translation to SMath.</p>
<p >The files responsible for the Session management and socket management can be found under the folder <code>SessionManager</code>.</p>
<div class="image">
<img src="communication.png" alt=""/>
<div class="caption">
Class Diagram of Communication Interface</div></div>
    <h2><a class="anchor" id="autotoc_md13"></a>
5. Draw Region and Draw Functions</h2>
<ol type="1">
<li><p class="startli">Draw region are custom region canvas that is added onto the worksheet via the menu bar <code>Insert &gt; Maxima &gt; Draw2D / Draw3D</code>. It shows the plot generated by Maxima onto the canvas and user can interact with it by performing various actions such as panning, zooming, and even save the image as a file.</p>
<p class="startli">The files that handles the draw region can be found in the folder <code>PlotImage</code>.</p>
</li>
</ol>
<div class="image">
<img src="drawingregion.png" alt=""/>
<div class="caption">
File dependencies of draw region</div></div>
    <ol type="1">
<li>Draw functions is a bit different than the draw region. Just like mathematical functions, draw functions are functions that is callable by the user from the worksheet. Instead of showing image, the output of this function is the absolute path to the generated plot. The function itself is managed by <code>Draw()</code> method in the file <code>DirectMaximaFunction.cs</code>. However, the plot options are managed by the file <code>PlotStore.cs</code>.</li>
</ol>
<h2><a class="anchor" id="autotoc_md14"></a>
6. Maxima Automatic Installation</h2>
<p >Within the folder <code>MInstaller</code> lies the classes that are responsible to perform HTTP request, extract the latest URL of Maxima from the JSON file, download the installer and execute the installer. This classes are used by the Settings Form which can be found in the folder <code>MForms</code>.</p>
<p >In the following sections, examples will be elaborated.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Examples</h1>
<h2><a class="anchor" id="autotoc_md16"></a>
1. Create new SMath Function</h2>
<p >In this creation we will use Cross product as an example.</p>
<ol type="1">
<li><p class="startli">Firstly in MainClass.cs under the IPluginHandleEvaluation.GetTermsHandled() method, add a new TermInfo(). Here, the definition of the function, the number of arguments and the type of arguments it takes are defined. Example is below:</p>
<div class="fragment"><div class="line"><span class="keyword">new</span> TermInfo (<span class="stringliteral">&quot;Cross&quot;</span>, TermType.Function,<span class="stringliteral">&quot;Cross(expr&quot;</span> + sessionProfile.ArgumentsSeparator + <span class="stringliteral">&quot; expr&quot;</span> + sessionProfile.ArgumentsSeparator + <span class="stringliteral">&quot;) Returns the result of cross product. Inputs are in form of vector. Also support 2D-Vectors. &quot;</span> , FunctionSections.Unknown , <span class="keyword">true</span>, <span class="keyword">new</span> ArgumentInfo(ArgumentSections.Expression), <span class="keyword">new</span> ArgumentInfo(ArgumentSections.Expression)),</div>
</div><!-- fragment --></li>
<li><p class="startli">Then in the same file under the IPluginLowLevelEvaluation.ExpressionEvaluation() method, we define the action that will be performed when the function "Cross" is called in SMath worksheet. In this case, we create a method in the file DirectMaximaFunction.cs which can be found in the folder MFunctions.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (root.Type == TermType.Function &amp;&amp; root.Text == <span class="stringliteral">&quot;Cross&quot;</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> MFunctions.DirectMaximaFunctions.CrossProduct(root, args, ref context, ref result);</div>
<div class="line">}</div>
</div><!-- fragment --><p class="startli">Few important thing when creating a new method to handle a new SMath function, the method is always a boolean type which will return true. If it return false, it will not be evaluated. Then, the arguments are in form of SMath term. The answer/output must be converted to Terms using the TermsConverter class before being set to the result. Example code is below.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> CrossProduct(Term root, Term[][] args, ref Store context, ref Term[] result)</div>
<div class="line">{</div>
<div class="line">    var arg1 = SharedFunctions.Proprocessing(args[0]);</div>
<div class="line">    var arg2 = SharedFunctions.Proprocessing(args[1]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// append all input as a single string of cross product command</span></div>
<div class="line">    <span class="keywordtype">string</span> stringtoMaxima = <span class="stringliteral">&quot;(&quot;</span> + arg1 + <span class="stringliteral">&quot;)&quot;</span> + <span class="stringliteral">&quot;†&quot;</span> + <span class="stringliteral">&quot;(&quot;</span> + arg2 + <span class="stringliteral">&quot;);&quot;</span> + <span class="stringliteral">&quot;express(%)&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// send to Maxima and retrieve result</span></div>
<div class="line">    <span class="keywordtype">string</span> outputFromMaxima = ControlObjects.Translator.Ask(stringtoMaxima);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//replace SMath list with mat</span></div>
<div class="line">    outputFromMaxima = Regex.Replace(outputFromMaxima,<span class="stringliteral">@&quot;sys&quot;</span>, <span class="stringliteral">&quot;mat&quot;</span>);</div>
<div class="line">    result = TermsConverter.ToTerms(outputFromMaxima);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md17"></a>
2. Add new Item in Toolbox</h2>
<p >Current the toolbox only support function without pre-defined arguments. To add a new button in the toolbox, we add a new ButtonMetaData into the GetToolboxGroups() method in the MainClass.cs. Here the size, description and the action will be defined. For the action it is adviseable to use the GetButtonAction() method that can be found in the class. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">new</span> ButtonsMetaData(<span class="stringliteral">&quot;Control&quot;</span>)</div>
<div class="line">    { Size = <span class="keyword">new</span> Size(54, 24), Description = <span class="stringliteral">&quot;Control Maxima process. E.g. Restarting the session by using MaximaControl(\&quot;restart\&quot;)&quot;</span>, Action = GetButtonAction(<span class="stringliteral">&quot;MaximaControl&quot;</span>, 1, sessionProfile) },</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
3. Add new Item in Menu Bar</h2>
<p >To add a new menu item in the menu bar, all you need is to add a new button in the IPluginCustomRegion.GetMenuItems() method in the MainClass.cs. The first argument is the name of the menu that will be visible to the user and the second argument is the function name. For example:</p>
<div class="fragment"><div class="line">menubutton.AppendChild(<span class="stringliteral">&quot;Restart&quot;</span>, MRestart);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
4. Adding new Plot Options</h2>
<p >Plot options for both draw region and draw functions are managed by PlotStore class in the folder PlotImage. In this example, an existing plot option will be used. For example, we want to add command that enable the x-Axis by default.</p>
<ol type="1">
<li><p class="startli">Create a getter and setter</p>
<p class="startli">To manage the enablexAxis option, you need to create a getter and setter in the PlotStore class, typically located at the bottom of the class. Depending on the option you want to implement, you can use a boolean, string, or the enum State available in the class.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">bool</span> enablexAxis</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">set</span> { _enablexAxis = value; }</div>
<div class="line">    <span class="keyword">get</span> { <span class="keywordflow">return</span> _enablexAxis; }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli">Set Default Value:</p>
<p class="startli">Next, set the default value or state of the plot option in the constructor. This ensures that the x-Axis is enabled by default.</p>
<div class="fragment"><div class="line">enablexAxis = <span class="keyword">true</span>;</div>
</div><!-- fragment --></li>
<li><p class="startli">Implement the option logic:</p>
<p class="startli">In the MakeLists method, you can write the logic that represents your variable. Here, you decide whether to include specific commands or preambles in the final output. In this case, when enablexAxis is true, you want to configure the x-Axis and its characteristics.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (enablexAxis)</div>
<div class="line">{</div>
<div class="line">    commandList.Add(<span class="stringliteral">&quot;xaxis=true&quot;</span>);</div>
<div class="line">    commandList.Add(<span class="stringliteral">&quot;xaxis_type=&quot;</span> + xAxisType);</div>
<div class="line">    commandList.Add(<span class="stringliteral">&quot;xaxis_color=&quot;</span> + xAxisColor);</div>
<div class="line">    commandList.Add(<span class="stringliteral">&quot;xaxis_width=&quot;</span> + xaxisWidth);</div>
<div class="line">} </div>
</div><!-- fragment --><p> These steps allow you to manage and configure the enablexAxis option in the PlotStore class effectively. Adjust the logic as needed for other plot options, using this as a guide. </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
